function loadImageArray(args){this.onCompletion=function(){if(typeof(this.onComplete)==="function"){var final_status=this.pollStatus();var retvalue={imagesArray:this.imagesArray,status:final_status}this.onComplete(retvalue)}return};this.onLoad=function(that){return function(){that.objectsLoaded+=1;that.check(that.onSingle,this)}};this.onError=function(that){return function(){that.objectsError+=1;that.check(that.onErr,this)}};this.check=function(callback,imageObj){if(typeof(callback)==='function'){var temp_status=this.pollStatus();callback({obj:imageObj,status:temp_status})}if(this.objectsLoaded+this.objectsError===this.objectsTotal){this.onCompletion()}}this.pollStatus=function(){return{id:this.ID,loaded:this.objectsLoaded,error:this.objectsError,total:this.objectsTotal}}this.ID=args.ID;this.onComplete=args.onComplete;this.onSingle=args.onSingle;this.onErr=args.onError;this.objectsLoaded=0;this.objectsError=0;this.objectsTotal=args.imageNames.length;this.imagesArray=[];for(var i=0;i<this.objectsTotal;i+=1){this.imagesArray[i]=new Image();this.imagesArray[i].onload=this.onLoad(this);this.imagesArray[i].onerror=this.onError(this);this.imagesArray[i].src=args.imageNames[i]}}function loadMultipleImages(args){this.loadingManager=function(){var that=this;return function(loaderStatus){var ls=loaderStatus;console.log(ls.status.id," called back to say everything is loaded.");if(that.loaders[ls.status.id]!==undefined){that.loaders[ls.status.id].done=true;that.loaders[ls.status.id].images=that.loaders[ls.status.id].imageArray.imagesArray;if(typeof(that.onSingleArray)==='function'){that.onSingleArray(loaderStatus)}}else{throw new Error("in loaders, "+ls.status.id+" is undefined")}for(var element in that.loaders){if(that.loaders.hasOwnProperty(element)){if(that.loaders[element].done!==true){console.log("status of element ",element," is not true: ",that.loaders[element].done);return}}}that.onComplete(that.loaders)}}this.errorManager=function(){var that=this;return function(errorStatus){if(typeof(that.onError)==='function'){that.onError(errorStatus)}}}this.singleManager=function(){var that=this;return function(singleStatus){if(typeof(that.onSingle)==='function'){that.onSingle(singleStatus)}}}this.multipleImages=args.multipleImages;this.onComplete=args.onComplete;this.onError=args.onError;this.onSingle=args.onSingle;this.onSingleArray=args.onSingleArray;this.loaders={};for(var i=0;i<this.multipleImages.length;i+=1){var loader={};loader.imageArray=new loadImageArray({ID:this.multipleImages[i].ID,imageNames:this.multipleImages[i].imageNames,onComplete:this.loadingManager(),onError:this.errorManager(),onSingle:this.singleManager()});loader.done=false;this.loaders[this.multipleImages[i].ID]=loader}}function extend(subClass,superClass){var F=function(){};F.prototype=superClass.prototype;subClass.prototype=new F();subClass.prototype.constructor=subClass;subClass.superclass=superClass.prototype;if(superClass.prototype.constructor==Object.prototype.constructor){superClass.prototype.constructor=superClass}}function Element(args){if(arguments.length){this.getready(args)}}Element.prototype.getready=function(args){this.ID=args.ID;this.isClickable=args.isClickable;if(typeof(this.isClickable)==='undefined'){this.isClickable=true}if(typeof(this.isClickable)!=='boolean'){throw"Property isClickable for element "+this.ID+" is not boolean "+this.isClickable}this.isVisible=args.isVisible;if(typeof(this.isVisible)==='undefined'){this.isVisible=true}if(typeof(this.isVisible)!=='boolean'){throw"Property isVisible for element "+this.ID+" is not boolean "+this.isVisible}this.xOrigin=args.left;this.yOrigin=args.top;if(args.ROILeft!==undefined){this.ROILeft=args.ROILeft}else{this.ROILeft=this.xOrigin}if(args.ROITop!==undefined){this.ROITop=args.ROITop}else{this.ROITop=this.yOrigin}this.ROIWidth=args.ROIWidth;this.ROIHeight=args.ROIHeight;this.values={};this.objParms=args.objParms;if(args!==undefined){this.onValueSet=args.onValueSet}};Element.prototype.isInROI=function(x,y){return false};Element.prototype.getValues=function(){var tempArray=[],i;for(i in this.values){if(this.values.hasOwnProperty(i)){tempArray.push(i)}}return tempArray};Element.prototype.getXCoord=function(){return this.xOrigin};Element.prototype.getYCoord=function(){return this.yOrigin};Element.prototype.getWidth=function(){return this.width};Element.prototype.getHeight=function(){return this.height};Element.prototype.setHeight=function(height){this.height=height;if(this.ROIHeight===undefined){this.ROIHeight=height}}Element.prototype.setWidth=function(width){this.width=width;if(this.ROIWidth===undefined){this.ROIWidth=width}}Element.prototype.getValue=function(slot){if(this.values[slot]===undefined){throw new Error("Slot "+slot+" not present or value undefined")}else{return this.values[slot]}};Element.prototype.setValue=function(slot,value){if(this.values[slot]===undefined){throw new Error("Slot "+slot+" not present or value undefined")}if(value===this.values[slot]){return}this.values[slot]=value};Element.prototype.setClickable=function(isClickable){if(typeof isClickable==="boolean"){this.isClickable=isClickable}else{throw"Property isClickable for element "+this.ID+" is not boolean "+isClickable}};Element.prototype.getClickable=function(){return this.isClickable};Element.prototype.refresh=function(drawPrimitive){};Element.prototype.getID=function(){return this.ID};Element.prototype.setDrawClass=function(drawClass){this.drawClass=drawClass};Element.prototype.setVisible=function(isVisible){if(typeof isVisible==="boolean"){this.isVisible=isVisible}else{throw"Property isVisible for element "+this.ID+" is not boolean "+isVisible}}Element.prototype.getVisible=function(){return this.isVisible}Element.prototype.onMouseMove=function(x,y){return undefined};Element.prototype.onMouseDown=function(x,y){return undefined};Element.prototype.onMouseUp=function(x,y){return undefined};Element.prototype.setGraphicWrapper=function(wrapper){this.wrapper=wrapper}function UI(domElement,wrapperFactory,parameters){this.getPosition=function(obj){var x=0,y=0;if(obj.offsetParent){do{x+=obj.offsetLeft;y+=obj.offsetTop;obj=obj.offsetParent}while(obj)}return{'x':x,'y':y}};this.getEventPosition=function(e,obj,scale){var evt,docX,docY,pos;evt=(e?e:window.event);if(evt.pageX||evt.pageY){docX=evt.pageX;docY=evt.pageY}else if(evt.clientX||evt.clientY){docX=evt.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;docY=evt.clientY+document.body.scrollTop+document.documentElement.scrollTop}pos=this.getPosition(obj);if(typeof scale==="undefined"){scale=1}return{'x':(docX-pos.x)/scale,'y':(docY-pos.y)/scale}};this.onMouseMoveFunc=function(){var that=this;return function(evt){var realCoords=that.getEventPosition(evt,that.domElement);if(that.mouseUp===false){that.elementsNotifyEvent(realCoords.x,realCoords.y,"onMouseMove")}}};this.onMouseDownFunc=function(){var that=this;return function(evt){var realCoords=that.getEventPosition(evt,that.domElement);that.mouseUp=false;that.elementsNotifyEvent(realCoords.x,realCoords.y,"onMouseDown")}};this.onMouseUpFunc=function(){var that=this;return function(evt){var realCoords=that.getEventPosition(evt,that.domElement);that.mouseUp=true;that.elementsNotifyEvent(realCoords.x,realCoords.y,"onMouseUp")}};this.elementsNotifyEvent=function(x,y,event){for(var z=this.zMax;z>=this.zMin;z-=1){if(this.zArray[z]!==undefined){for(var k=(this.zArray[z].length-1);k>=0;k-=1){if(this.zArray[z][k].getClickable()){ret=this.zArray[z][k][event](x,y);if(ret!==undefined){if(ret instanceof Array){for(var i=0;i<ret.length;i+=1){this.setValue({elementID:this.zArray[z][k].ID,slot:ret[i].slot,value:ret[i].value})}}else{this.setValue({elementID:this.zArray[z][k].ID,slot:ret.slot,value:ret.value})}if(this.breakOnFirstEvent===true){return}}}}}}};this.domElement=domElement;this.domElement.addEventListener("mousedown",this.onMouseDownFunc(),true);this.domElement.addEventListener("mouseup",this.onMouseUpFunc(),true);this.domElement.addEventListener("mousemove",this.onMouseMoveFunc(),true);this.mouseUp=true;var ret;this.elements={};this.connections={};this.zArray=[];this.graphicWrapper=wrapperFactory;if(parameters!==undefined){this.breakOnFirstEvent=parameters.breakOnFirstEvent||false}this.addElement=function(element,elementParameters){var slot,slots;if(this.elements[element.ID]!==undefined){throw new Error("Conflicting / Duplicated ID in UI: "+element.ID+" (IDs are identifiers and should be unique)");return}this.elements[element.ID]=element;element.setGraphicWrapper(this.graphicWrapper);this.connections[element.ID]={};slots=element.getValues();for(slot in slots){if(slots.hasOwnProperty(slot)){this.connections[element.ID][slots[slot]]=[]}}var zIndex=0;if(elementParameters!==undefined){zIndex=elementParameters.zIndex}if((zIndex<0)||(typeof(zIndex)!=="number")){throw new Error("zIndex "+zIndex+" invalid")}this.elements[element.ID].zIndex=zIndex;if(this.zArray[zIndex]===undefined){this.zArray[zIndex]=[]}this.zArray[zIndex].push(this.elements[element.ID]);if((this.zMin===undefined)||(this.zMin>zIndex)){this.zMin=zIndex}if((this.zMax===undefined)||(this.zMax<zIndex)){this.zMax=zIndex}};this.connectSlots=function(senderElement,senderSlot,receiverElement,receiverSlot,connectParameters){if((this.elements[senderElement]!==undefined)&&(this.elements[receiverElement]!==undefined)){if((this.elements[senderElement].values[senderSlot]===undefined)||(this.elements[receiverElement].values[receiverSlot]===undefined)){throw new Error("Slot "+senderSlot+" or "+receiverSlot+" not present.")}else{var receiverHash={"recvElement":receiverElement,"recvSlot":receiverSlot};if(connectParameters!==undefined){if(typeof(connectParameters.callback)==="function"){receiverHash.callback=connectParameters.callback}receiverHash.cascade=true;if(connectParameters.cascade!==undefined){receiverHash.cascade=connectParameters.cascade}}this.connections[senderElement][senderSlot].push(receiverHash)}}else{throw new Error("Element "+senderElement+" or "+receiverElement+" not present.")}};this.setValue=function(setParms){var hist=[],receiverHash,recvElementID,recvSlot,i,RECURSIONMAX=1000,elementID,value,slot,fireCallback,history;if(typeof(setParms.elementID)==='undefined'){throw("ID is undefined")}else elementID=setParms.elementID;if(typeof(setParms.value)==='undefined'){throw("value is undefined")}else value=setParms.value;if(typeof(setParms.fireCallback)==='undefined'){fireCallback=true}else fireCallback=setParms.fireCallback;history=setParms.history;if(this.elements[elementID]!==undefined){if(typeof(setParms.slot)==='undefined'){slot=this.elements[elementID].defaultSlot;if(typeof(slot)===undefined){throw"Default slot is undefined!"}}else slot=setParms.slot;if(history!==undefined){hist=history;for(var k=0;k<hist.length;k+=1){if(hist.length>RECURSIONMAX){throw new Error("Recursion exceeded");return}if((hist[k]["element"]===elementID)&&(hist[k]["slot"]===slot)){console.log("Broke recursion!");return}}}this.elements[elementID].setValue(slot,value,fireCallback);if((typeof(this.elements[elementID].onValueSet)==="function")&&(fireCallback!==false)){this.elements[elementID].onValueSet(slot,this.elements[elementID].values[slot],this.elements[elementID].ID)}hist.push({"element":elementID,"slot":slot})}else{throw new Error("Element "+elementID+" not present.")}if(this.connections[elementID][slot]!==undefined){for(i in this.connections[elementID][slot]){if(this.connections[elementID][slot].hasOwnProperty(i)){receiverHash=this.connections[elementID][slot][i];recvElementID=receiverHash.recvElement;recvSlot=receiverHash.recvSlot;if(typeof(receiverHash.callback)==="function"){value=receiverHash.callback(value)}var fire_conn_callback;if(receiverHash.cascade===false){fire_conn_callback=false}else{fire_conn_callback=true}this.setValue({elementID:recvElementID,slot:recvSlot,value:value,history:hist,fireCallback:fire_conn_callback})}}}};this.hideElement=function(elementID){var visibilityState;if(this.elements[elementID]!==undefined){visibilityState=this.elements[elementID].getVisible();if(visibilityState===true){this.elements[elementID].setVisible(false);this.elements[elementID].setClickable(false)}}else{throw new Error("Element "+elementID+" not present.")}}this.unhideElement=function(elementID){var visibilityState;if(this.elements[elementID]!==undefined){visibilityState=this.elements[elementID].getVisible();if(visibilityState===false){this.elements[elementID].setVisible(true);this.elements[elementID].setClickable(true)}}else{throw new Error("Element "+elementID+" not present.")}}this.setHidden=function(elementID,value){this.setVisible(elementID,!value)}this.setVisible=function(elementID,value){var visibilityState;if(this.elements[elementID]!==undefined){visibilityState=this.elements[elementID].getVisible();if(visibilityState!==value){this.elements[elementID].setVisible(value);this.elements[elementID].setClickable(value)}}else{throw new Error("Element "+elementID+" not present.")}}this.setClickable=function(elementID,value){var state;if(this.elements[elementID]!==undefined){state=this.elements[elementID].getClickable();if(state!==value){this.elements[elementID].setClickable(value)}}else{throw new Error("Element "+elementID+" not present.")}}this.refreshZ=function(z){for(var i=z,length=this.zArray.length;i<length;i+=1){if(typeof(this.zArray[i])==="object"){for(var k=0,z_length=this.zArray[i].length;k<z_length;k+=1){if(this.zArray[i][k].getVisible()===true){this.zArray[i][k].refresh()}}}}}this.refresh=function(doReset){if(this.zMin!==undefined){this.refreshZ(this.zMin)}}this.reset=function(){this.graphicWrapper.reset()}}function Background(args){if(arguments.length){this.getready(args)}}extend(Background,Element);Background.prototype.getready=function(args){if(args===undefined){throw new Error("Error: args is undefined!")}Background.superclass.getready.call(this,args);this.values={"backgroundvalue":0};this.defaultSlot="backgroundvalue";this.image=args.image;this.setWidth(this.image.width);this.setHeight(this.image.height)};Background.prototype.GetImage=function(){return this.image};Background.prototype.isInROI=function(x,y){if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){return true}return false}};Background.prototype.onMouseDown=function(x,y){if(this.isInROI(x,y)){this.triggered=true}return undefined};Background.prototype.onMouseUp=function(curr_x,curr_y){var to_set=0,ret={};if(this.triggered){if(this.isInROI(curr_x,curr_y)){ret={"slot":"backgroundvalue","value":0};this.triggered=false;return ret}}return undefined};Background.prototype.refresh=function(){if(this.drawClass!==undefined){Background.superclass.refresh.call(this,this.drawClass.drawImage);if(this.isVisible===true){this.drawClass.drawImage.draw(this.image,this.xOrigin,this.yOrigin)}}};Background.prototype.setGraphicWrapper=function(wrapper){Background.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawImage",objParms:this.objParms}])};function Button(args){if(arguments.length){this.getready(args)}}extend(Button,Element);Button.prototype.getready=function(args){if(args===undefined){throw new Error("Error: args is undefined!")}Button.superclass.getready.call(this,args);this.values={"buttonvalue":0};this.defaultSlot="buttonvalue";this.triggered=false;this.imagesArray=args.imagesArray;if(this.imagesArray.length<1){throw new Error("Invalid images array length, "+this.imagesArray.length)}this.nButtons=this.imagesArray.length;for(var i=0;i<this.nButtons;i+=1){this.setWidth(this.imagesArray[i].width);this.setHeight(this.imagesArray[i].height)}};Button.prototype.isInROI=function(x,y){if((x>=this.ROILeft)&&(y>=this.ROITop)){if((x<=(this.ROILeft+this.ROIWidth))&&(y<=(this.ROITop+this.ROIHeight))){return true}}return false};Button.prototype.onMouseDown=function(x,y){if(this.isInROI(x,y)){this.triggered=true}return undefined};Button.prototype.onMouseUp=function(curr_x,curr_y){var to_set=0,ret={};if(this.triggered){if(this.isInROI(curr_x,curr_y)){to_set=(this.values.buttonvalue+1)%this.nButtons;ret={"slot":"buttonvalue","value":to_set};this.triggered=false;return ret}}return undefined};Button.prototype.setValue=function(slot,value,fireCallback){if((value<0)||(value>this.nButtons)){return}Button.superclass.setValue.call(this,slot,value,fireCallback)};Button.prototype.refresh=function(){if(this.drawClass!==undefined){Button.superclass.refresh.apply(this,[this.drawClass.drawImage]);if(this.isVisible===true){this.drawClass.drawImage.draw(this.imagesArray[this.values.buttonvalue],this.xOrigin,this.yOrigin)}}};Button.prototype.setGraphicWrapper=function(wrapper){Button.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawImage",objParms:this.objParms}])};Button.prototype.setStatesNumber=function(number){this.nButtons=number};Button.prototype.getStatesNumber=function(){return this.nButtons}function Knob(args){if(arguments.length){this.getready(args)}}extend(Knob,Element);Knob.prototype.getready=function(args){if(args===undefined){throw new Error("Error: specArgs is undefined!")}Knob.superclass.getready.call(this,args);this.values={"knobvalue":0};this.defaultSlot="knobvalue";this.sensitivity=args.sensitivity||2000;this.imagesArray=args.imagesArray||null;if(this.imagesArray.length<1){throw new Error("Invalid images array length, "+this.imagesArray.length)}var width=0,height=0;for(var i=0,len=this.imagesArray.length;i<len;i+=1){if(this.imagesArray[i].width>width){width=this.imagesArray[i].width}if(this.imagesArray[i].height>height){height=this.imagesArray[i].height}}this.setWidth(width);this.setHeight(height)};Knob.prototype._getImageNum=function(){if((this.values.knobvalue<0)||(this.values.knobvalue>1)){return undefined}var ret=Math.round(this.values.knobvalue*(this.imagesArray.length-1));return ret};Knob.prototype._getImage=function(){var ret=this._getImageNum();return this.imagesArray[ret]};Knob.prototype.isInROI=function(x,y){if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){return true}}return false};Knob.prototype.onMouseDown=function(x,y){var inROI=this.isInROI(x,y);if(inROI){this.start_x=x;this.start_y=y}return undefined};Knob.prototype.onMouseUp=function(x,y){this.start_x=undefined;this.start_y=undefined;return undefined};Knob.prototype.onMouseMove=function(curr_x,curr_y){if((this.start_x!==undefined)&&(this.start_y!==undefined)){var deltaY=0,temp_value,to_set,ret;deltaY=curr_y-this.start_y;temp_value=this.values.knobvalue;to_set=temp_value-deltaY/this.sensitivity;if(to_set>1){to_set=1}if(to_set<0){to_set=0}ret={"slot":"knobvalue","value":to_set};return ret}return undefined};Knob.prototype.setValue=function(slot,value,fireCallback){var temp_value=value;if((temp_value<0)||(temp_value>1)){return}Knob.superclass.setValue.call(this,slot,value,fireCallback)};Knob.prototype.refresh=function(){if(this.drawClass!==undefined){Knob.superclass.refresh.call(this,this.drawClass.drawImage);if(this.isVisible===true){var imageNum=this._getImageNum();this.drawClass.drawImage.draw(this.imagesArray[imageNum],this.xOrigin,this.yOrigin)}}};Knob.prototype.setGraphicWrapper=function(wrapper){Knob.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawImage",objParms:this.objParms}])};function RotKnob(args){if(arguments.length){this.getready(args)}}extend(RotKnob,Element);RotKnob.prototype.getready=function(args){if(args===undefined){throw new Error("Error: specArgs is undefined!")}RotKnob.superclass.getready.call(this,args);this.values={"knobvalue":0,"realknobvalue":0}this.defaultSlot="knobvalue";if(args.initAngValue===undefined){this.initAngValue=0}else{this.initAngValue=args.initAngValue}if(args.moveDirection=='anticlockwise'){this.moveDirection=-1}else{this.moveDirection=1}this.startAngValue=args.startAngValue||0;this.stopAngValue=args.stopAngValue||360;this.angSteps=args.angSteps;var sens=args.sensitivity||2000;this.sensitivity=Math.round((sens/360)*(Math.abs(this.stopAngValue-this.startAngValue)));this.image=args.image;this.setWidth(this.image.width);this.setHeight(this.image.height)};RotKnob.prototype._getRotateAmount=function(){if((this.values.knobvalue<0)||(this.values.knobvalue>1)){return undefined}var angularValue=this.values.knobvalue*360;var rangedAngularValue=360-(angularValue*(this.startAngValue-this.stopAngValue)/360+this.stopAngValue)%360;var offsetAngularValue=(360-this.initAngValue+rangedAngularValue)%360;var ret=offsetAngularValue*Math.PI/180;return ret};RotKnob.prototype.isInROI=function(x,y){if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){return true}}return false};RotKnob.prototype.onMouseDown=function(x,y){var inROI=this.isInROI(x,y);if(inROI){this.start_x=x;this.start_y=y}return undefined};RotKnob.prototype.onMouseUp=function(x,y){this.start_x=undefined;this.start_y=undefined;return undefined};RotKnob.prototype.onMouseMove=function(curr_x,curr_y){if((this.start_x!==undefined)&&(this.start_y!==undefined)){var deltaY=0,temp_value,to_set,ret;deltaY=curr_y-this.start_y;temp_value=this.values.realknobvalue;to_set=temp_value-((deltaY/this.sensitivity)*this.moveDirection);if(to_set>1){to_set=1}if(to_set<0){to_set=0}ret={"slot":"knobvalue","value":to_set};return ret}return undefined};RotKnob.prototype.setValue=function(slot,value,fireCallback){var stepped_new_value;if((value<0)||(value>1)){return}if(this.values[slot]===undefined){throw new Error("Slot "+slot+" not present or value undefined")}if((value===this.values[slot])||(value===this.values['real'+slot])){return}this.values['real'+slot]=value;if((this.angSteps)!==undefined){var single_step=1/this.angSteps;stepped_new_value=Math.floor(value/single_step)*single_step;if(stepped_new_value===this.values[slot]){return}}else{stepped_new_value=value}console.log("Value is: ",stepped_new_value);RotKnob.superclass.setValue.call(this,slot,stepped_new_value,fireCallback)};RotKnob.prototype.refresh=function(){if(this.drawClass!==undefined){RotKnob.superclass.refresh.call(this,this.drawClass.drawImage);if(this.isVisible===true){var rot=this._getRotateAmount();this.drawClass.drawImage.drawRotate(this.image,this.xOrigin,this.yOrigin,rot)}}};RotKnob.prototype.setGraphicWrapper=function(wrapper){RotKnob.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawImage",objParms:this.objParms}])};function Label(args){if(arguments.length){this.getready(args)}}extend(Label,Element);Label.prototype.getready=function(args){Label.superclass.getready.call(this,args);this.values={"labelvalue":""};this.defaultSlot="labelvalue";this.setWidth(args.width);this.setHeight(args.height)};Label.prototype.isInROI=function(x,y){if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){return true}}return false};Label.prototype.setValue=function(slot,value,fireCallback){Label.superclass.setValue.call(this,slot,value,fireCallback)};Label.prototype.refresh=function(){var text;if(this.drawClass!==undefined){Label.superclass.refresh.call(this,this.drawClass.drawText);if(this.isVisible===true){text=this.values.labelvalue;this.drawClass.drawText.draw(text,this.xOrigin,this.yOrigin,this.width,this.height)}}};Label.prototype.setGraphicWrapper=function(wrapper){Label.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawText",objParms:this.objParms}])}function Multiband(args){if(arguments.length){this.getready(args)}}extend(Multiband,Element);Multiband.prototype.getready=function(args){if(args===undefined){throw new Error("Error: specArgs is undefined!")}var valueName,i;Multiband.superclass.getready.call(this,args);this.nBands=args.nBands;this.sideBands=new Array(this.nBands);this.values={};for(i=0;i<args.nBands;i+=1){valueName=i+"sp";this.values[valueName]=0;valueName=i+"ep";this.values[valueName]=0;valueName=i+"width";this.values[valueName]=0;valueName=i+"height";this.values[valueName]=0;valueName=i+"color";this.values[valueName]=0}this.defaultSlot="0sp";this.values.colorRange=args.colorRange;this.drawClass=args.wrapper.initObject([{objName:"drawRect",objParms:args.objParms}]);this.setWidth(args.width);this.setHeight(args.height)};Multiband.prototype.calculateSidebands=function(){var startValue,endValue,heightValue,startXPoint,endXPoint,yPoint,i;for(i=0;i<this.nBands;i+=1){startValue=this.values[i+"sp"];endValue=this.values[i+"ep"];heightValue=this.values[i+"height"];startXPoint=this.xOrigin+(this.width*startValue);endXPoint=this.xOrigin+(this.width*endValue);yPoint=this.yOrigin+(1-this.height*heightValue);this.sideBands[i]={"startXPoint":startXPoint,"endXPoint":endXPoint,"yPoint":yPoint}}};Multiband.prototype.isInROI=function(x,y){var proximity,i,curSB;if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){proximity=3;this.calculateSidebands();for(i=0;i<this.nBands;i+=1){curSB=this.sideBands[i];if(y<curSB.yPoint){continue}if((x>curSB.startXPoint-proximity)&&(x<curSB.startXPoint+proximity)){this.sideBand=[0,i];return true}if((x>curSB.endXPoint-proximity)&&(x<curSB.endXPoint+proximity)){this.sideBand=[1,i];return true}}}}return false};Multiband.prototype.onROI=function(start_x,start_y,curr_x,curr_y){var temp_value,to_set,ret,startSlot,endSlot,prevEndSlot,nextStartSlot,deltaX;deltaX=curr_x-start_x;if(this.sideBand[0]===0){if(this.sideBand[1]===0){temp_value=this.values.band0sp;to_set=temp_value-deltaX/2000;if(to_set>=this.values["0ep"]){to_set=this.values["0ep"]}if(to_set<0){to_set=0}ret={"slot":"0sp","value":to_set};return ret}startSlot=this.sideBand[1]+"sp";endSlot=this.sideBand[1]+"ep";prevEndSlot=(this.sideBand[1]-1)+"ep";temp_value=this.values[startSlot];to_set=temp_value-deltaX/2000;if(to_set>=this.values[endSlot]){to_set=this.values[endSlot]}if(to_set<=this.values[prevEndSlot]){to_set=this.values[prevEndSlot]}ret={"slot":startSlot,"value":to_set};return ret}else if(this.sideBand[0]===1){if(this.sideBand[1]===0){startSlot=this.sideBand[this.nBands]+"sp";endSlot=this.sideBand[this.nBands]+"ep";temp_value=this.values[endSlot];to_set=temp_value-deltaX/2000;if(to_set<this.values[startSlot]){to_set=this.values[startSlot]}if(to_set>1){to_set=1}ret={"slot":endSlot,"value":to_set};return ret}startSlot=this.sideBand[1]+"sp";endSlot=this.sideBand[1]+"ep";nextStartSlot=(this.sideBand[1]+1)+"sp";temp_value=this.values[endSlot];to_set=temp_value-deltaX/2000;if(to_set<this.values[startSlot]){to_set=this.values[startSlot]}if(to_set>this.values[nextStartSlot]){to_set=this.values[nextStartSlot]}ret={"slot":endSlot,"value":to_set};return ret}else{throw new Error("Error: sideband is neither start not end.")}};Multiband.prototype.setValue=function(slot,value,fireCallback){var bandn,bandtype,previous,next;bandn=parseInt(slot,10);bandtype=slot.substring(slot.length-2);if((bandtype==="sp")||(bandtype==="ep")){previous=undefined;next=undefined;if((bandtype==="sp")&&(bandn===0)){if(value>this.values["0ep"]){value=this.values["0ep"]}}else if((bandtype==="ep")&&(bandn===this.nBands-1)){previous=bandn+"sp";if(value<this.values[previous]){value=this.values[previous]}}else{if(bandtype==="sp"){previous=(bandn-1)+"ep";next=bandn+"ep"}else if(bandtype==="ep"){previous=bandn+"sp";next=(bandn+1)+"sp"}if(value<this.values[previous]){value=this.values[previous]}if(value>this.values[next]){value=this.values[next]}}}if(this.values[slot]===undefined){throw new Error("Slot "+slot+" not present or value undefined")}if(value===this.values[slot]){return}this.values[slot]=value};Multiband.prototype.refresh=function(){var height,range,colValue,color_shade,i;Multiband.superclass.refresh.apply(this,[this.drawClass.drawRect]);if((this.drawClass!==undefined)&&(this.isVisible===true)){this.calculateSidebands();for(i=0;i<this.nBands;i+=1){height=(1-this.values[i+"height"])*this.height;range=this.values.colorRange;colValue=this.values[i+"color"];color_shade=(colValue-0.5)*range;this.drawClass.drawRect.draw(this.sideBands[i].startXPoint,this.yOrigin+height,this.sideBands[i].endXPoint-this.sideBands[i].startXPoint,this.height-height,color_shade)}}};function Wavebox(args){if(arguments.length){this.getready(args)}}extend(Wavebox,Element);Wavebox.prototype.getready=function(args){Wavebox.superclass.getready.call(this,args);this.values={"waveboxposition":0,"startsample":0,"endsample":null,"waveboxsignal":undefined};this.defaultSlot="waveboxposition";this.setWidth(args.width);this.setHeight(args.height)};Wavebox.prototype.isInROI=function(x,y){if((x>this.ROILeft)&&(y>this.ROITop)){if((x<(this.ROILeft+this.ROIWidth))&&(y<(this.ROITop+this.ROIHeight))){return true}}return false};Wavebox.prototype.setValue=function(slot,value,fireCallback){if(this.values[slot]===undefined){throw new Error("Slot "+slot+" not present or value undefined")}if(this.values[slot]===value){return}if((slot==="startsample")||(slot==="endsample")){if(value<0){throw new Error("Error: Trying to set ",slot," less than 0: ",value)}if(this.values["waveboxsignal"]!==undefined){if(value>this.values["waveboxsignal"].length){throw new Error("Error: Trying to set ",slot," bigger than signal length: ",value," > ",this.values["waveboxsignal"].length)}}}if(slot==="startsample"){if(value>this.values["endsample"]){throw new Error("Error: Trying to set startsample > endsample: ",value," > ",this.values["endsample"])}}if(slot==="endsample"){if(value<this.values["startample"]){throw new Error("Error: Trying to set endsample < startsample: ",value," < ",this.values["startsample"])}}this.values[slot]=value;console.log("set value for slot ",slot);if(slot==="waveboxsignal"){console.log("inside!");this.values["endsample"]=this.values["waveboxsignal"].length;this.values["startsample"]=0}};Wavebox.prototype.refresh=function(){if(this.drawClass!==undefined){Wavebox.superclass.refresh.call(this,this.drawClass.drawPath);if(this.isVisible===true){var oldpoint=0;this.drawClass.drawPath.beginDraw();for(var i=0;i<this.width;i+=1){var point=this.calculateSampleCoord(i);if(point!==oldpoint){this.drawClass.drawPath.draw(point.x,point.y)}oldpoint=point}this.drawClass.drawPath.endDraw()}}};Wavebox.prototype.sampleindexToY=function(samplenum){if((samplenum>=this.values.endsample)||(this.values.waveboxsignal[samplenum]===undefined)||(this.values.waveboxsignal[samplenum]===null)){throw new Error("Error: problem with sample index: ",samplenum," or sample value: ",this.values.waveboxsignal[samplenum])}var range01=(this.values.waveboxsignal[samplenum]+1)/2;var temp=((1-range01)*this.height);var y=this.yOrigin+temp;return parseInt(y,10)}Wavebox.prototype.sampleXToIndex=function(xcoord){var factor=((this.values.endsample-this.values.startsample)/this.width);var x=xcoord*factor;var ret=parseInt(x,10);return ret}Wavebox.prototype.calculateSampleCoord=function(xcoord){var ret={};ret.x=xcoord+this.xOrigin;ret.y=this.sampleindexToY(this.sampleXToIndex(xcoord));return ret}Wavebox.prototype.setGraphicWrapper=function(wrapper){Wavebox.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawPath",objParms:this.objParms}])};function Slider(args){if(arguments.length){this.getready(args)}}extend(Slider,Element);Slider.prototype.getready=function(args){if(args===undefined){throw new Error("Error: specArgs is undefined!")}Slider.superclass.getready.call(this,args);this.values={"slidervalue":0};this.defaultSlot="slidervalue";this.width=0;this.height=0;this.sliderImage=args.sliderImg;this.knobImage=args.knobImg;this.type=args.type;this.calculateDimensions()};Slider.prototype._getKnobPosition=function(){var ret;if((this.values.slidervalue<0)||(this.values.slidervalue>1)){return undefined}switch(this.type){case"horizontal":ret=Math.round(this.values.slidervalue*this.width+this.zeroLimit);break;case"vertical":ret=Math.round(this.values.slidervalue*this.height+this.zeroLimit);break;default:throw new Error("Error: Slider orientation is undefined!")}return ret};Slider.prototype.isInROI=function(x,y){switch(this.type){case"horizontal":if((x>this._getKnobPosition())&&(y>this.ROITop)){if((x<(this._getKnobPosition()+this.kWidth))&&(y<(this.ROITop+this.kHeight))){return true}}break;case"vertical":if((y>this._getKnobPosition())&&(x>this.ROILeft)){if((y<(this._getKnobPosition()+this.kHeight))&&(x<(this.ROILeft+this.kWidth))){return true}}break;default:throw new Error("Error: Slider orientation is undefined!")}return false};Slider.prototype.onMouseDown=function(x,y){if(this.isInROI(x,y)){this.triggered=true;switch(this.type){case"horizontal":this.drag_offset=x-this._getKnobPosition();break;case"vertical":this.drag_offset=y-this._getKnobPosition();break;default:throw new Error("Error: Slider orientation is undefined!")}}return undefined};Slider.prototype.onMouseUp=function(x,y){this.triggered=false;this.drag_offset=undefined;return undefined};Slider.prototype.onMouseMove=function(curr_x,curr_y){if(this.triggered===true){var to_set,ret;switch(this.type){case"horizontal":to_set=(curr_x-this.zeroLimit-this.drag_offset)/(this.width);break;case"vertical":to_set=(curr_y-this.zeroLimit-this.drag_offset)/(this.height);break;default:throw new Error("Error: Slider orientation is undefined!")}if(to_set>1){to_set=1}if(to_set<0){to_set=0}ret={"slot":"slidervalue","value":to_set};return ret}return undefined};Slider.prototype.setValue=function(slot,value,fireCallback){if((value<0)||(value>1)){return}Slider.superclass.setValue.call(this,slot,value,fireCallback)};Slider.prototype.refresh=function(){if(this.drawClass===undefined){return}else{if((this.drawClass!==undefined)&&(this.isVisible===true)){this.drawClass.drawImage.draw(this.sliderImage,this.xOrigin,this.yOrigin);switch(this.type){case"horizontal":this.drawClass.drawImage.draw(this.knobImage,this._getKnobPosition(),this.yOrigin);break;case"vertical":this.drawClass.drawImage.draw(this.knobImage,this.xOrigin,this._getKnobPosition());break;default:throw new Error("Error: Slider orientation is undefined!")}}}};Slider.prototype.calculateDimensions=function(){this.kWidth=this.knobImage.width;this.kHeight=this.knobImage.height;this.setWidth(this.sliderImage.width);this.setHeight(this.sliderImage.height);switch(this.type){case"horizontal":this.totalStride=this.width+this.kWidth;this.additionalEndSpace=Math.round(this.kWidth/2);this.zeroLimit=this.xOrigin-this.additionalEndSpace;this.oneLimit=this.xOrigin+this.width+this.additionalEndSpace;break;case"vertical":this.totalStride=this.height+this.kHeight;this.additionalEndSpace=Math.round(this.kHeight/2);this.zeroLimit=this.yOrigin-this.additionalEndSpace;this.oneLimit=this.yOrigin+this.height+this.additionalEndSpace;break;default:throw new Error("Error: Slider orientation is undefined!")}};Slider.prototype.setGraphicWrapper=function(wrapper){Slider.superclass.setGraphicWrapper.call(this,wrapper);this.drawClass=wrapper.initObject([{objName:"drawImage",objParms:this.objParms}])};function NonOverlappingMultiknob(args){if(arguments.length){this.getready(args)}}extend(NonOverlappingMultiknob,Element);NonOverlappingMultiknob.prototype.getready=function(args){NonOverlappingMultiknob.superclass.getready.call(this,args);this.KnobArray=[];this.ROIKnob=undefined;var nKnobs,tempKnob,knob,valuename,i;nKnobs=args.coordinates.length;this.objectsTotal=nKnobs*args.images.length;for(i=0;i<nKnobs;i+=1){var knobSpecArgs={images:args.images};tempKnob=new Knob(i,args.coordinates[i],knobSpecArgs);this.KnobArray.push(tempKnob)}this.values={};for(i=0;i<this.KnobArray.length;i+=1){valuename="knobvalue"+this.KnobArray[i].name;this.values[valuename]=i}this.defaultSlot="knobvalue0"};NonOverlappingMultiknob.prototype.isInROI=function(x,y){var nKnobs,i;nKnobs=this.KnobArray.length;for(i=0;i<nKnobs;i+=1){if(this.KnobArray[i].isInROI(x,y)===true){this.ROIKnob=i;return true}}return false};NonOverlappingMultiknob.prototype.onMouseDown=function(x,y){var knobret,inROI;inROI=this.isInROI(x,y);if(inROI===true){knobret=this.KnobArray[this.ROIKnob].onMouseDown(x,y)}return knobret};NonOverlappingMultiknob.prototype.onMouseUp=function(x,y){var knobret;if(this.ROIKnob!==undefined){knobret=this.KnobArray[this.ROIKnob].onMouseUp(x,y)}this.ROIKnob=undefined;return knobret}NonOverlappingMultiknob.prototype.onMouseMove=function(x,y){var knobret;if(this.ROIKnob!==undefined){knobret=this.KnobArray[this.ROIKnob].onMouseMove(x,y);if(knobret!==undefined){var ret={"slot":("knobvalue"+this.ROIKnob),"value":knobret.value};return ret}}return undefined}NonOverlappingMultiknob.prototype.setValue=function(slot,value){var knobN;if((value<0)||(value>1)){return}knobN=parseInt(this.values[slot],10);if(knobN===0){if(value<0){value=0}if(value>this.KnobArray[knobN+1].values.knobvalue){value=this.KnobArray[knobN+1].values.knobvalue}}else if(knobN===(this.KnobArray.length-1)){if(value>1){value=1}if(value<this.KnobArray[knobN-1].values.knobvalue){value=this.KnobArray[knobN-1].values.knobvalue}}else{if(value<this.KnobArray[knobN-1].values.knobvalue){value=this.KnobArray[knobN-1].values.knobvalue}if(value>this.KnobArray[knobN+1].values.knobvalue){value=this.KnobArray[knobN+1].values.knobvalue}}this.KnobArray[knobN].setValue("knobvalue",value)};NonOverlappingMultiknob.prototype.refresh=function(){var i;if(this.drawClass===undefined){throw new Error("Error: drawClass is undefined!")}else{for(i=0;i<this.KnobArray.length;i+=1){if(this.KnobArray[i].drawClass===undefined){this.KnobArray[i].drawClass=this.drawClass}this.KnobArray[i].refresh()}}};NonOverlappingMultiknob.prototype.getValue=function(slot){var knobN=this.values[slot];this.KnobArray[knobN].getValue("knobvalue")};CANVAS_WRAPPER={drawImage:function(canvas){this.canvasC=canvas this.draw=function(image,x,y){this.canvasC.drawImage(image,x,y)}this.drawRotate=function(image,x,y,rot,rot_type){this.canvasC.save();this.canvasC.translate(x+(image.width/2),y+(image.height/2));this.canvasC.rotate(rot);this.canvasC.translate(-(image.width/2)-x,-(image.height/2)-y);this.canvasC.drawImage(image,x,y);this.canvasC.restore()}this.saveBackground=function(left,top,width,height){this.backgroundPixels=this.canvasC.getImageData(left,top,width,height);this.bgX=left;this.bgY=top}this.restoreBackground=function(){this.canvasC.putImageData(this.backgroundPixels,this.bgX,this.bgY)}},drawText:function(canvas,textParms){this.canvasC=canvas;var HTML5TextParameters=['fillStyle','font','textAlign','textBaseline'];var canvasPropStorage={};this.font=textParms.font||"verdana";this.textColor=textParms.textColor||null;this.textAlignment=textParms.textAlignment||null;this.textBaseline=textParms.textBaseline||null;this.draw=function(text,x,y,width,length){canvasPropStorage.tempBaseline=this.canvasC.textBaseline;canvasPropStorage.tempAlign=this.canvasC.textAlign;canvasPropStorage.tempFont=this.canvasC.font;canvasPropStorage.tempfillStyle=this.canvasC.fillStyle;if(this.textBaseline!==null){this.canvasC.textBaseline=this.textBaseline}if(this.textAlignment!==null){this.canvasC.textAlign=this.textAlignment}if(this.font!==null){this.canvasC.font=this.font}if(this.textColor!=null){this.canvasC.fillStyle=this.textColor}this.canvasC.fillText(text,x,y);this.canvasC.textBaseline=canvasPropStorage.tempBaseline;this.canvasC.textAlign=canvasPropStorage.tempAlign;this.canvasC.font=canvasPropStorage.tempFont;this.canvasC.fillStyle=canvasPropStorage.tempfillStyle}this.saveBackground=function(left,top,width,height){var xcoord,ycoord,wd,hg;xcoord=left;ycoord=top;wd=width;hg=height;if(this.textBaseline==='bottom'){ycoord=top-height}if(this.textBaseline==='middle'){ycoord=top-height/2}if(this.textAlignment==='end'){xcoord=xcoord-wd;if(xcoord<0){xcoord=0}}this.backgroundPixels=this.canvasC.getImageData(xcoord,ycoord,wd,hg);this.bgX=xcoord;this.bgY=ycoord}this.restoreBackground=function(){this.canvasC.putImageData(this.backgroundPixels,this.bgX,this.bgY)}},drawRect:function(canvas){function HexToR(h){return parseInt((cutHex(h)).substring(0,2),16)}function HexToG(h){return parseInt((cutHex(h)).substring(2,4),16)}function HexToB(h){return parseInt((cutHex(h)).substring(4,6),16)}function cutHex(h){return(h.charAt(0)=="#")?h.substring(1,7):h}function RGB2HTML(R,G,B){var red=parseInt(R);var green=parseInt(G);var blue=parseInt(B);var hexcode=fillZero(red.toString(16))+fillZero(green.toString(16))+fillZero(blue.toString(16));return'#'+hexcode.toUpperCase()}function fillZero(myString){if(myString.length==1)return"0"+myString;else return myString}this.canvasC=canvas;this.fillStyle=undefined;this.setFillStyle=function(color){this.fillStyle=color}this.setClearStyle=function(color){this.clearStyle=color}this.setStroke=function(stroke){this.stroke=stroke}this.draw=function(x,y,width,length,shade){var R=HexToR(this.fillStyle);var G=HexToG(this.fillStyle);var B=HexToB(this.fillStyle);R+=shade;G+=shade;B+=shade;if(R<0){R=0}if(G<0){G=0}if(B<0){B=0}if(R>255){R=255}if(G>255){G=255}if(B>255){B=255}var realColor=RGB2HTML(R,G,B);this.reallyDraw(x,y,width,length,realColor)}this.draw=function(x,y,width,length,color){var tempfillStyle=this.canvasC.fillStyle;this.canvasC.fillStyle=color;this.canvasC.fillRect(x,y,width,length);this.canvasC.fillStyle=tempfillStyle}},drawPoint:function(canvas,color,dimension){this.canvasC=canvas;this.fillStyle=color;this.dimension=dimension;this.draw=function(x,y){var tempfillStyle=this.canvasC.fillStyle;this.canvasC.fillStyle=this.fillStyle;this.canvasC.fillRect(x,y,this.dimension,this.dimension);this.canvasC.fillStyle=tempfillStyle}},drawPath:function(canvas,pathParms){this.canvasC=canvas;this.inited=false;this.pathColor=pathParms.pathColor||null;this.pathDimension=pathParms.pathDimension;this.draw=function(x,y){var tempfillStyle=this.canvasC.fillStyle;this.canvasC.fillStyle=this.pathColor;if(this.inited===false){this.canvasC.beginPath();this.canvasC.moveTo(x,y);this.inited=true}else{this.canvasC.lineTo(x,y)}this.canvasC.fillStyle=tempfillStyle}this.beginDraw=function(){this.inited=false}this.endDraw=function(){this.inited=false;var tempfillStyle=this.canvasC.fillStyle;this.canvasC.fillStyle=this.fillStyle;this.canvasC.stroke();this.canvasC.fillStyle=tempfillStyle}this.saveBackground=function(left,top,width,height){this.backgroundPixels=this.canvasC.getImageData(left,top,width,height);this.bgX=left;this.bgY=top}this.restoreBackground=function(){this.canvasC.putImageData(this.backgroundPixels,this.bgX,this.bgY)}},staticMethods:{save2d:function(that,left,top,width,height){that.backgroundPixels=that.canvasC.getImageData(left,top,width,height);that.bgX=left;that.bgY=top},restore2d:function(that){that.canvasC.putImageData(that.backgroundPixels,that.bgX,that.bgY)},reset:function(that){that.canvasC.width=that.canvasC.width}}}var K2WRAPPER={};K2WRAPPER.createWrapper=function(type,args){switch(type){case"CANVAS_WRAPPER":if(args.canvas!==undefined){return new canvasWrapperCreator(args.canvas)}break;default:}function canvasWrapperCreator(canvas){this.reset=function(){this.canvas.width=this.canvas.width}this.canvas=canvas;this.context=canvas.getContext("2d");this.wrapper=CANVAS_WRAPPER;this.initObject=function(list){var ret={};for(var i=0;i<list.length;i+=1){var name=list[i].objName;var parms=list[i].objParms;var func=this.wrapper[name];var obj=new func(this.context,parms);ret[name]=obj;ret[name]["staticMethods"]=this.wrapper.staticMethods}return ret}}}